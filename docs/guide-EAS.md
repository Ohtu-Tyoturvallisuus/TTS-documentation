# Guide to EAS Build, Submit, and Update Scripts

In this project, we use Expo Application Services (EAS) for building, submitting, and updating the app. Below are detailed instructions on how each script works and when to use them.

### Prerequisites

Before running the scripts, ensure you have the following installed and configured:
- **Node.js** and **npm** installed.
- [**Expo**](https://expo.dev/signup) account and [**Apple Developer Program**](https://developer.apple.com/programs/) account are required for app submission.
- The necessary credentials and permissions set up for iOS builds in your Expo account.

You can view and modify these scripts directly in the `package.json` file under the `scripts` section.

For further guidance on using EAS, visit the official Expo documentation here: [Expo Guide Overview](https://docs.expo.dev/guides/overview/).

> **Note:** EAS Build and EAS Submit are automated in our GitHub Actions workflows. You can find the workflow configurations here:
- [**CD-HazardHunt**](https://github.com/Ohtu-Tyoturvallisuus/TTS-frontend/blob/main/.github/workflows/eas-build-submit-all.yml)
- [**CD-HazardHunt-UAT**](https://github.com/Ohtu-Tyoturvallisuus/TTS-frontend/blob/main/.github/workflows/eas-build-submit-all-uat.yml)
- [**CD-HazardHunt-Production**](https://github.com/Ohtu-Tyoturvallisuus/TTS-frontend/blob/main/.github/workflows/eas-build-submit-all-prod.yml)

---

## Build, Submit, and Update Scripts for EAS

This guide outlines how to build, submit, and update the app for different platforms (`iOS`, `Android`, or both) and environments (`main`, `uat`, `production`).

### Environments and Testing Stages

- **Main Profile:** Used for **internal testing** within the development team.
- **UAT Profile:** 
  - For Android, this is referred to as **closed testing** in Google Play.
  - For iOS (via TestFlight), this is known as **external testing**.
- **Production Profile:** Used for **live releases** to the App Store and Google Play.

---

### Build Scripts

Use these scripts to create builds:

- **iOS Builds:**
  ```bash
  npm run build:ios:main
  ```
  Build for **internal testing**.

  ```bash
  npm run build:ios:uat
  ```
  Build for **user acceptance testing (UAT)** (TestFlight External Testing).

  ```bash
  npm run build:ios:production
  ```
  Build for **release** to the App Store.

- **Android Builds:**
  ```bash
  npm run build:android:main
  ```
  Build for **internal testing**.

  ```bash
  npm run build:android:uat
  ```
  Build for **UAT** (Google Play Closed Testing).

  ```bash
  npm run build:android:production
  ```
  Build for **release** to Google Play.

- **All Platforms:**
  ```bash
  npm run build:all:main
  ```
  Build both platforms for **internal testing**.

  ```bash
  npm run build:all:uat
  ```
  Build both platforms for **UAT**.

  ```bash
  npm run build:all:production
  ```
  Build both platforms for **release**.

---

### Submit Scripts

Use these scripts to submit the latest builds. They fetch the most recent build artifacts generated by EAS and upload them to App Store Connect and/or Google Play Console:

- **iOS Submissions:**
  ```bash
  npm run submit:ios:main
  ```
  Submit for **internal testing**.

  ```bash
  npm run submit:ios:uat
  ```
  Submit for **UAT** (TestFlight External Testing).

  ```bash
  npm run submit:ios:production
  ```
  Submit for **release** to the App Store.

- **Android Submissions:**
  ```bash
  npm run submit:android:main
  ```
  Submit for **internal testing**.

  ```bash
  npm run submit:android:uat
  ```
  Submit for **UAT** (Google Play Closed Testing).

  ```bash
  npm run submit:android:production
  ```
  Submit for **release** to Google Play.

- **All Platforms:**
  ```bash
  npm run submit:all:main
  ```
  Submit both platforms for **internal testing**.

  ```bash
  npm run submit:all:uat
  ```
  Submit both platforms for **UAT**.

  ```bash
  npm run submit:all:production
  ```
  Submit both platforms for **release**.

> **Important:** For EAS Submit to work when using a local terminal, ensure that your `eas.json` file contains valid values for `appleId`, `ascAppId`, and `appleTeamId`. These fields might be set to `"intentionally_left_blank"` for security reasons and should be updated with real values manually. Also, remember to **avoid pushing real credentials** to GitHub by keeping your sensitive information secure and excluding it from version control.

---

### Update Scripts (Over-the-Air Updates)

Use these scripts to push minor updates (e.g., UI tweaks, bug fixes) directly to users without requiring a full rebuild or re-submission to app stores.

```bash
npm run update:all:main -- --message "Your update message"
```
Push OTA updates to the **main** branch for **internal testing**.

```bash
npm run update:all:uat -- --message "Your update message"
```
Push OTA updates to the **uat** branch for **UAT** (TestFlight External Testing or Google Play Closed Testing).

```bash
npm run update:all:production -- --message "Your update message"
```
Push OTA updates to the **production** branch for **live users**.

**Notes:**
- The `--message` flag is **mandatory** and should clearly describe the update.
- Updates are applied when users reopen the app.
- More information how **EAS Update** works can be found [**here**](https://docs.expo.dev/eas-update/how-it-works/)

---